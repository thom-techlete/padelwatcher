"""add_court_config_to_search_requests

Revision ID: 8aa107bdc8ba
Revises: 6d0154cbdd02
Create Date: 2025-11-21 22:35:44.783612

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "8aa107bdc8ba"
down_revision: Union[str, Sequence[str], None] = "6d0154cbdd02"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table("_prisma_migrations")
    op.alter_column(
        "availabilities",
        "date",
        existing_type=sa.DATETIME(),
        type_=sa.Date(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "start_time",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "end_time",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "price",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "available",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(true)"),
    )
    op.drop_constraint(None, "availabilities", type_="foreignkey")
    op.create_foreign_key(None, "availabilities", "courts", ["court_id"], ["id"])
    op.alter_column(
        "courts",
        "name",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "courts",
        "sport",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "courts",
        "indoor",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "courts",
        "double",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.drop_constraint(None, "courts", type_="foreignkey")
    op.create_foreign_key(None, "courts", "locations", ["location_id"], ["id"])
    op.alter_column(
        "locations",
        "name",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "locations",
        "tenant_id",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "slug",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "address",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "opening_hours",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "sport_ids",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "communications_language",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.drop_index(op.f("locations_slug_key"), table_name="locations")
    op.create_unique_constraint(None, "locations", ["slug"])
    op.drop_constraint(None, "locations", type_="foreignkey")
    op.create_foreign_key(None, "locations", "providers", ["provider_id"], ["id"])
    op.alter_column(
        "providers",
        "name",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.drop_index(op.f("providers_name_key"), table_name="providers")
    op.create_unique_constraint(None, "providers", ["name"])
    op.alter_column(
        "search_order_notifications",
        "notified",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.create_foreign_key(
        None, "search_order_notifications", "search_orders", ["search_order_id"], ["id"]
    )
    op.create_foreign_key(
        None,
        "search_order_notifications",
        "availabilities",
        ["availability_id"],
        ["id"],
    )
    op.create_foreign_key(
        None, "search_order_notifications", "courts", ["court_id"], ["id"]
    )
    op.alter_column(
        "search_orders",
        "date",
        existing_type=sa.DATETIME(),
        type_=sa.Date(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "start_time_range",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "end_time_range",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "created_at",
        existing_type=sa.DATETIME(),
        nullable=True,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "search_orders",
        "status",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        nullable=True,
        existing_server_default=sa.text("'active'"),
    )
    op.alter_column(
        "search_orders",
        "user_id",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.alter_column(
        "search_requests",
        "search_hash",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "date",
        existing_type=sa.DATETIME(),
        type_=sa.Date(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "start_time",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "end_time",
        existing_type=sa.TEXT(),
        type_=sa.Time(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "court_type",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        nullable=True,
        existing_server_default=sa.text("'all'"),
    )
    op.alter_column(
        "search_requests",
        "court_config",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
        existing_server_default=sa.text("'all'"),
    )
    op.alter_column(
        "search_requests",
        "location_ids",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "live_search",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "search_requests",
        "performed_at",
        existing_type=sa.DATETIME(),
        nullable=True,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "search_requests",
        "slots_found",
        existing_type=sa.INTEGER(),
        nullable=True,
        existing_server_default=sa.text("0"),
    )
    op.drop_index(op.f("search_requests_search_hash_key"), table_name="search_requests")
    op.create_unique_constraint(None, "search_requests", ["search_hash"])
    op.alter_column(
        "users",
        "email",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "users",
        "password_hash",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "users",
        "user_id",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=False,
    )
    op.alter_column(
        "users",
        "approved",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "users",
        "active",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(true)"),
    )
    op.alter_column(
        "users",
        "is_admin",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "users",
        "created_at",
        existing_type=sa.DATETIME(),
        nullable=True,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "users",
        "approved_by",
        existing_type=sa.TEXT(),
        type_=sa.String(),
        existing_nullable=True,
    )
    op.drop_index(op.f("users_email_key"), table_name="users")
    op.drop_index(op.f("users_user_id_key"), table_name="users")
    op.create_unique_constraint(None, "users", ["email"])
    op.create_unique_constraint(None, "users", ["user_id"])
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, "users", type_="unique")
    op.drop_constraint(None, "users", type_="unique")
    op.create_index(op.f("users_user_id_key"), "users", ["user_id"], unique=1)
    op.create_index(op.f("users_email_key"), "users", ["email"], unique=1)
    op.alter_column(
        "users",
        "approved_by",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "users",
        "created_at",
        existing_type=sa.DATETIME(),
        nullable=False,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "users",
        "is_admin",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "users",
        "active",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(true)"),
    )
    op.alter_column(
        "users",
        "approved",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "users",
        "user_id",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "users",
        "password_hash",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "users",
        "email",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.drop_constraint(None, "search_requests", type_="unique")
    op.create_index(
        op.f("search_requests_search_hash_key"),
        "search_requests",
        ["search_hash"],
        unique=1,
    )
    op.alter_column(
        "search_requests",
        "slots_found",
        existing_type=sa.INTEGER(),
        nullable=False,
        existing_server_default=sa.text("0"),
    )
    op.alter_column(
        "search_requests",
        "performed_at",
        existing_type=sa.DATETIME(),
        nullable=False,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "search_requests",
        "live_search",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "search_requests",
        "location_ids",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "court_config",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
        existing_server_default=sa.text("'all'"),
    )
    op.alter_column(
        "search_requests",
        "court_type",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        nullable=False,
        existing_server_default=sa.text("'all'"),
    )
    op.alter_column(
        "search_requests",
        "end_time",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "start_time",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "date",
        existing_type=sa.Date(),
        type_=sa.DATETIME(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_requests",
        "search_hash",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "user_id",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "search_orders",
        "status",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        nullable=False,
        existing_server_default=sa.text("'active'"),
    )
    op.alter_column(
        "search_orders",
        "created_at",
        existing_type=sa.DATETIME(),
        nullable=False,
        existing_server_default=sa.text("(CURRENT_TIMESTAMP)"),
    )
    op.alter_column(
        "search_orders",
        "end_time_range",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "start_time_range",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "search_orders",
        "date",
        existing_type=sa.Date(),
        type_=sa.DATETIME(),
        existing_nullable=False,
    )
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.drop_constraint(None, "search_order_notifications", type_="foreignkey")
    op.create_foreign_key(
        None,
        "search_order_notifications",
        "search_orders",
        ["search_order_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.create_foreign_key(
        None,
        "search_order_notifications",
        "availabilities",
        ["availability_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.create_foreign_key(
        None,
        "search_order_notifications",
        "courts",
        ["court_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.alter_column(
        "search_order_notifications",
        "notified",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.drop_constraint(None, "providers", type_="unique")
    op.create_index(op.f("providers_name_key"), "providers", ["name"], unique=1)
    op.alter_column(
        "providers",
        "name",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.drop_constraint(None, "locations", type_="foreignkey")
    op.create_foreign_key(
        None,
        "locations",
        "providers",
        ["provider_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.drop_constraint(None, "locations", type_="unique")
    op.create_index(op.f("locations_slug_key"), "locations", ["slug"], unique=1)
    op.alter_column(
        "locations",
        "communications_language",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "sport_ids",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "opening_hours",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "address",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "slug",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "tenant_id",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "locations",
        "name",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.drop_constraint(None, "courts", type_="foreignkey")
    op.create_foreign_key(
        None,
        "courts",
        "locations",
        ["location_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.alter_column(
        "courts",
        "double",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "courts",
        "indoor",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(false)"),
    )
    op.alter_column(
        "courts",
        "sport",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=True,
    )
    op.alter_column(
        "courts",
        "name",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.drop_constraint(None, "availabilities", type_="foreignkey")
    op.create_foreign_key(
        None,
        "availabilities",
        "courts",
        ["court_id"],
        ["id"],
        onupdate="CASCADE",
        ondelete="RESTRICT",
    )
    op.alter_column(
        "availabilities",
        "available",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("(true)"),
    )
    op.alter_column(
        "availabilities",
        "price",
        existing_type=sa.String(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "end_time",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "start_time",
        existing_type=sa.Time(),
        type_=sa.TEXT(),
        existing_nullable=False,
    )
    op.alter_column(
        "availabilities",
        "date",
        existing_type=sa.Date(),
        type_=sa.DATETIME(),
        existing_nullable=False,
    )
    op.create_table(
        "_prisma_migrations",
        sa.Column("id", sa.TEXT(), nullable=False),
        sa.Column("checksum", sa.TEXT(), nullable=False),
        sa.Column("finished_at", sa.DATETIME(), nullable=True),
        sa.Column("migration_name", sa.TEXT(), nullable=False),
        sa.Column("logs", sa.TEXT(), nullable=True),
        sa.Column("rolled_back_at", sa.DATETIME(), nullable=True),
        sa.Column(
            "started_at",
            sa.DATETIME(),
            server_default=sa.text("(current_timestamp)"),
            nullable=False,
        ),
        sa.Column(
            "applied_steps_count",
            sa.INTEGER(),
            server_default=sa.text("0"),
            nullable=False,
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    # ### end Alembic commands ###
